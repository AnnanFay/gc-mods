A new message system + minor bugs and fixes.